<!DOCTYPE html>
  <html>
    <head>
      <title>Title</title>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
      <link href="themes/remark-dark.css" rel="stylesheet" media="all" type="text/css"/>
    </head>
    <body>
      <textarea id="source">
title: xquery01 : une introduction
description: Atelier outillage XML (langages et logiciels), consortium Cahier 2015, Emmanuel Château, Maud Ingarao
theme: ../themes/remark-dark.css
name: inverse
layout: true
class: inverse

---
name: index
class: center middle

# 00-XQuery01, Une Introduction

### Consortium cahier | 1er et 2 juin 2015

.footnote[[entrepôt GitHub](https://ahn-ens-lyon/formCahier2015) | [jour1](#jour1) | [jour2](#jour2)]

---
name: presentation
layout: false
class: left

# XQuery

### Standardisé par le le W3C
### Opère sur XML Data Model ([XDM](http://www.w3.org/TR/xpath-datamodel-30/))
### en 2007 [version 1 du langage](http://www.w3.org/TR/xquery/)
### en 2011 extension [XQuery Update Facility](http://www.w3.org/TR/xquery-update-10/)
### en 2011 extension [XQuery Full-text](http://www.w3.org/TR/xpath-full-text-10/)
### en 2014 [version 3](http://www.w3.org/TR/xquery-30/) du langage

???
- Language standardisé par le W3C pour requêter des données XML.
- Publication d’une première version du language en 2007
- Extension pour le plein-texte et la mise à jour publiées en 2011
- Nouvelle version 3 publiée standardisée cette année en mars 2014.

Références :

- XQuery 1.0: An XML Query Language (Second Edition), Don Chamberlin, Jonathan Robie, Anders Berglund, Scott Boag, et. al., Editors. World Wide Web Consortium, 14 December 2010. http://www.w3.org/TR/xquery/.

- XQuery 1.0 and XPath 2.0 Data Model (XDM) (Second Edition), Anders Berglund, Mary Fernández, Ashok Malhotra, Jonathan Marsh, Marton Nagy, Norman Walsh, Editors. World Wide Web Consortium, 14 December 2010. http://www.w3.org/TR/xpath-datamodel/.
- XQuery 1.0 and XPath 2.0 Formal Semantics (Second Edition), Jérôme Siméon, Denise Draper, Peter Frankhauser, et. al., Editors. World Wide Web Consortium, 14 December 2010. http://www.w3.org/TR/xquery-semantics/.

- XQuery 3.0 Requirements, Daniel Engovatov, Jonathan Robie, Editors. World Wide Web Consortium, 08 April 2014. http://www.w3.org/TR/xquery-30-requirements/
- World Wide Web Consortium. XML Query Use Cases. W3C Working Draft, 8 June 2006. http://www.w3.org/TR/xquery-use-cases/.
- XQuery and XPath Functions and Operators 3.0, Michael Kay, Editor. World Wide Web Consortium, 08 April 2014. http://www.w3.org/TR/xpath-functions-30/
- XSLT and XQuery Serialization 3.0, Henry Zongaro, Andrew Coleman, Michael Sperberg-McQueen, Editors. World Wide Web Consortium, 08 April 2014. http://www.w3.org/TR/xslt-xquery-serialization-30/

- XQuery and XPath Data Model (XDM) 3.0, Norman Walsh, Anders Berglund, John Snelson, Editors. World Wide Web Consortium, 08 April 2014. http://www.w3.org/TR/xpath-datamodel-30/.

- EXPath, http://expath.org
- EXPath Wiki, http://wiki.expath.org/wiki/EXPath

Pour mémoire XQuery Use Cases 2001 http://www.w3.org/TR/2001/WD-xmlquery-use-cases-20010215

---

# À quoi sert XQuery ?

### requêter des données stockées en XML
### manipuler des fichiers
### transporter des messages entre applications
### rendre du XML en HTMl ou dans un autre format

???
XQuery a d’abord été conçu comme un langage pour requêter des données stockées en XML. Son principal rôle intervient donc avec les bases de données XML qu’il s’agisse de bases de données nativement XML ou bien de XML stockées dans des bases de données relationnelles.

On peut également utiliser XQuery pour manipuler des fichiers XML stockées dans un système de fichier, ou bien pour transformer des messages en les passant d’une application à l’autre. Ici, l’utilisation de XQuery entre en concurrence avec XSLT et est principalement une question de choix.

Certains aprécient tellement XQuery qu’ils cherchent à l’employer pour transformer du XML en HTML présentationnel. Ce n’est pas réellement l’utilisation pour laquelle ce langaeg a été conçu (pas forcément conseillé).

---

# XQuery vs XSLT

### opère sur le même modèle de données
### partage de XPath et fonctions prédéfinies
### fonctionnalités comparables
### expressivité / efficience comparables
### XQuery plus adapté pour la requête
### pas de règles modèles dans XQuery (`<xsl:template>`)

???
XQuery plus "pull" que "push"
XSLT charge l’ensemble du document
tandis que XQuery peut utiliser des index

voir

---

# Installation de BaseX

### Vérifiez que vous disposez de [Java 8.0](https://www.java.com/fr/download/help/index_installing.xml)

### Télécharger l’archive appropriée sur :

http://basex.org/products/download/all-downloads/

(choisir l’archive zip sur MacOS et Linux)

### Pour exécuter BaseX
- double-cliquez sur `BaseX.jar`
- lancez le script d’exécution de la GUI : `bin/basexgui`
- lancez le script d’exécution du client : `bin/basex`
- lancez le script d’exécution du serveur HTTP : `bin/basexhttp`

---

# Votre première requête XQuery

### Allez dans `Fichier nouveau`

### Tapez l’instruction suivante
```xquery
"Hello World !"
```
### Exécutez l’instruction en appuyant sur Entrée

---

# D’autres exemples

## Plus intéressant, essayez :
```xquery
2 + 2
```
Sans surprise, le résultat devrait être `4`

## Pour connaître l’heure :
```xquery
current-time()
```

???

Exemples :
- calcul arithmétique
- utilisation d’une fonction

Bien évidemment, aucune de ces requêtes ne sont très utiles en elles-mêmes, et ce qu’elles démontrent n’est pas de la haute science. Mais au sein d’un langage de requête, on peut avoir besoin de faire certains calculs, ce qui est possible avec XQuery. Nous verrons par ailleurs, que XQuery est un langage fonctionnel Turing complet.

XQuery est aussi conçu de manière à ce que les expressions soient complètement imbricables. N’importe quelle expression peut être employée dans n’importe quelle autre expression pourvu qu’elle délivre une valeur du type approprié. Ce qui implique que les expressions qui sont essentiellement employées pour selectionner des données au sein d’une clause `where` par exemple, peuvent aussi être employées comme des requêtes autonomes.

---

# Accéder à des documents XML

Chemin du document que nous allons utiliser :
`exemples/document.xml`

```xquery
fn:doc('chemin/document.xml')
```

## Lister les `persName` dans le document

en XPath :
```
//tei:persName
```

en XQuery :
```
fn:doc( 'chemin/document.xml' )//tei:persName
```

Compter les `persName`
```
fn:count( fn:doc('chemin/document.xml')//tei:persName )
```

???
Même s’il est capable de prendre en charge des tâches telles que celles décrites précédemment, XQuery est principalement conçu pour accéder à des données XML. Regardons maintenant un exemple qui requiert en entrée un document XML.

Un exemple en XML est contenu dans le répertoire `exemple/` au sein du dossier de la formation. C’est un document XML-TEI qui comporte plusieurs divisions.
- Vous pouvez ouvrir le document en XQuery avec la fonction `fn:doc`
- Vous pouvez également accéder aux divisions du document

---

# Les expressions FLOWR

---

# Exemple de FLOWR expression

For $var in expr
Let $var := expr
Where condition
Order by expr
Return expr

???
Itérer sur ensemble et lier variable
affecter variable
Condition d’après expression
Tri
Retour, évaluation expression


---

# Les Types

---

# Les opérateurs

- `>`, `<`, `=`, `>=`, `<=` comparaison, égalité
- `+`, `-`, `*`, `/` addition, soustraction, multiplication, division
- % modulo [vérifier]

---

# Booléens

`fn:true()`, `fn:false()`
`!=`
eq

---

# Exemple de FLOWR expression

---

# Processeurs XQuery 3.0

- BaseX, http://basex.org
- eXistDB, http://exist-db.org
- Zorba, http://www.zorba.io
- Saxon, http://www.saxonica.com

---

# TEI use cases

- eXist, Wiki de la TEI, http://wiki.tei-c.org/index.php/EXist
- BaseX, Wiki de la TEI, http://wiki.tei-c.org/index.php/Basex
- Joseph Wicentowski, An Introduction to XML Databases : Creating a TEI-Bases Website with the eXist-db XML Database, DHOXSS 2011 http://digital.humanities.ox.ac.uk/dhoxss/2011/presentations/Wicentowski-XMLDatabases.pdf
- Punch, https://github.com/joewiz/punch
- Morgan, Kyle, and Kyle Schutt. Final project report for CS 5604, Fall 2012 (Project Byron), December, 2012.	https://vtechworks.lib.vt.edu/bitstream/handle/10919/19082/ProjByronFinal.pdf
- Burghart, Marjorie. "EXist-db, Une Base XML Native Pour L’exploitation De Corpus TEI - Les Raisons D’un Choix Et Les Modalités De Son Implémentation." In Exploiter Les Données Structurées En XML. Paris, France, 2011. https://halshs.archives-ouvertes.fr/halshs-00980843.	

# Sources

- [Michael Kay, Learn XQuery in 10 Minutes: An XQuery Tutorial](http://www.stylusstudio.com/xquery-primer-new.html)
- Eisenberg, David J.. "Comparing XSLT and XQuery." http://www.xml.com/pub/a/2005/03/09/xquery-v-xslt.html (accessed June 27, 2014).

---

# Bibliographie

- Walmsley, Priscilla. XQuery. Beijing ; Sebastopol, Calif.: O'Reilly, 2007. isbn 0596006349
- Brundage, Michael. XQuery : The XML Query Language. Boston: Addison-Wesley, 2004.	isbn 0321165810
- Le Maitre, Jacques, and Emmanuel Bruno. XQuery Pour Interroger Des Données et Éléments Du Langage Et Mise En Oeuvre : Cours Et Exercices Corrigés. Paris: Ellipses, 2013. isbn 2729883487
- Ronald Bourret, XML et les bases de données, Patrick Peccatte (traducteur), novembre 2003.

    </textarea>
    <script src="js/remark-0.6.5.min.js" type="text/javascript"></script>
    <script type="text/javascript">
    var hljs = remark.highlighter.engine;</script>
    <script src="remark.language.js" type="text/javascript"></script>
    <script type="text/javascript">
    var slideshow = remark.create({
    highlightStyle: 'monokai',
    highlightLanguage: 'remark'
    }) ;
    </script>
  </body>
</html>
